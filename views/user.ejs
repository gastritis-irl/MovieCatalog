<!-- Path: views/user.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
    <title>User Profile</title>
    <script src="/userScript.js" defer></script>
    <link rel="stylesheet" type="text/css" href="/styles/button2.css">
    <link rel="stylesheet" type="text/css" href="/styles/styles.css">
    <link rel="stylesheet" type="text/css" href="/styles/user.css">

</head>
<body>
    <h1>User: <%= user.username %></h1>
    <nav>
        <% if (locals.user) { %>
            <span>Welcome, <%= locals.user.username %>!</span> | <a href="/logout" id="logout-button">Logout</a>
        <% } else { %>
            <a href="/login">Login</a> | <a href="/register">Register</a>
        <% } %>
    </nav>
    <h2>Movies</h2>
    <ul>
        <% user.movies.forEach(function(movie){ %>
            <li>
                <a href="/movies/<%= movie._id %>"><%= movie.title %></a>
                <% if (typeof locals.user !== 'undefined' && user._id.toString() === locals.user._id.toString()) { %>
                    <button onclick="deleteMovie('<%= movie._id %>')">Delete</button>
                <% } %>
            </li>
        <% }); %>
    </ul>

    <h2>Reviews</h2>
    <ul>
        <% user.reviews.forEach(function(review){ %>
        <li>
        <%= review.content %> (for <a href="/movies/<%= review.movieId %>"><%= review.movieTitle %></a>)
        </li>
        <% }); %>
    </ul>

    <% if (typeof locals.user !== 'undefined' && user._id.toString() === locals.user._id.toString()) { %>
    <a href="/add-movie">Add a movie</a>
    <h2>Add Movie</h2>
        <form id="add-movie-form" action="/api/movies" method="post">
            <label for="movie-title">Title:</label>
            <input type="text" id="movie-title" name="title" required><br>
            <label for="movie-genre">Genre:</label>
            <input type="text" id="movie-genre" name="genre" required><br>
            <button type="submit">Add Movie</button>
        </form>
    <% } %>
</body>
</html>
